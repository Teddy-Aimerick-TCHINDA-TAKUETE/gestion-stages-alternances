import{a as J}from"./chunk-BBH67TY2.js";import{a as Q}from"./chunk-A4HBSWL7.js";import{a as K}from"./chunk-BYWXCTMR.js";import{$ as k,A as v,B as c,C as F,D as l,E as b,F as x,G as E,O as M,Q as w,R as P,T,Y as O,Z as U,da as D,ea as R,fa as S,g,ga as A,h as _,ha as z,ja as V,ka as N,l as C,la as q,ma as L,n as a,na as j,oa as B,p as m,pa as $,q as y,qa as G,s as p,sa as H,t as d,ta as W,u as n,v as r,w as f,z as h}from"./chunk-XPQBKRV7.js";function Y(t,i){t&1&&(n(0,"label",29),l(1,"S\xE9lectionner votre nom :"),r())}function Z(t,i){if(t&1&&(n(0,"option",31),l(1),r()),t&2){let e=i.$implicit;d("value",e.id),a(),E(" ",e.prenom," ",e.nom," ")}}function ee(t,i){if(t&1&&(n(0,"select",30)(1,"option",10),l(2,"-- S\xE9lectionnez votre profil --"),r(),p(3,Z,2,3,"option",11),r()),t&2){let e=c(2);a(3),d("ngForOf",e.etudiants)}}function te(t,i){t&1&&(n(0,"span"),l(1,"\u274C L'etudiant est requis."),r())}function ie(t,i){if(t&1&&(n(0,"div",32),p(1,te,2,0,"span",2),r()),t&2){let e,o=c(2);a(),d("ngIf",(e=o.candidatureForm.get("etudiantId"))==null||e.errors==null?null:e.errors.required)}}function re(t,i){if(t&1&&(n(0,"option",31),l(1),r()),t&2){let e=i.$implicit;d("value",e.id),a(),E(" ",e.titre," (",e.type,") ")}}function ne(t,i){t&1&&(n(0,"span"),l(1,"\u274C Le stage/alternance est requis."),r())}function ae(t,i){if(t&1&&(n(0,"div",32),p(1,ne,2,0,"span",2),r()),t&2){let e,o=c(2);a(),d("ngIf",(e=o.candidatureForm.get("stageId"))==null||e.errors==null?null:e.errors.required)}}function oe(t,i){if(t&1&&(n(0,"span"),l(1),r()),t&2){let e=c(2);a(),b(e.selectedFile.name)}}function de(t,i){t&1&&(n(0,"span",33),l(1,"Aucun fichier s\xE9lectionn\xE9"),r())}function le(t,i){if(t&1){let e=h();n(0,"button",34),v("click",function(){g(e);let u=c(2);return _(u.removeSelectedFile())}),l(1," \u274C Supprimer le fichier "),r()}}function se(t,i){if(t&1&&f(0,"iframe",37),t&2){let e=c(3);d("src",e.pdfPreviewUrl,C)}}function ce(t,i){if(t&1&&(n(0,"div",35)(1,"label"),l(2,"\u{1F4C4} Aper\xE7u du CV :"),r(),p(3,se,1,1,"iframe",36),r()),t&2){let e=c(2);a(3),d("ngIf",e.pdfPreviewUrl)}}function ue(t,i){if(t&1&&(n(0,"div",38),l(1),r()),t&2){let e=c(2);a(),x(" ",e.cvErrorMessage," ")}}function pe(t,i){if(t&1&&(n(0,"p",39),l(1),r()),t&2){let e=c(2);a(),b(e.lettreMotivationFile.name)}}function me(t,i){if(t&1){let e=h();n(0,"button",40),v("click",function(){g(e);let u=c(2);return _(u.clearLettreMotivation())}),l(1," \u274C Supprimer le fichier "),r()}}function fe(t,i){if(t&1&&(n(0,"div",41)(1,"label"),l(2,"Aper\xE7u de la lettre :"),r(),f(3,"iframe",37),r()),t&2){let e=c(2);a(3),d("src",e.lettreMotivationPreviewUrl,C)}}function ve(t,i){if(t&1&&(n(0,"div",38),l(1),r()),t&2){let e=c(2);a(),x(" ",e.lettreErrorMessage," ")}}function ge(t,i){if(t&1){let e=h();n(0,"div"),p(1,Y,2,0,"label",5)(2,ee,4,1,"select",6)(3,ie,2,1,"div",7),f(4,"br")(5,"br"),n(6,"label",8),l(7,"S\xE9lectionner un stage/alternance :"),r(),n(8,"select",9)(9,"option",10),l(10,"-- Choisissez un stage --"),r(),p(11,re,2,3,"option",11),r(),p(12,ae,2,1,"div",7),f(13,"br")(14,"br"),n(15,"label"),l(16,"Date a partir de laquelle vous ete disponible :"),r(),f(17,"input",12)(18,"br")(19,"br"),n(20,"label",13),l(21,"Message (facultatif) :"),r(),f(22,"textarea",14)(23,"br")(24,"br"),n(25,"div",15)(26,"label",16),l(27," \u{1F4CE} Remplacer le CV (PDF obligatoire) "),r(),n(28,"input",17),v("change",function(u){g(e);let s=c();return _(s.onFileSelected(u))}),r(),n(29,"div",18),p(30,oe,2,1,"span",19)(31,de,2,0,"ng-template",null,0,M),r(),p(33,le,2,0,"button",20)(34,ce,4,1,"div",21)(35,ue,2,1,"div",22),r(),f(36,"br")(37,"br"),n(38,"div",23)(39,"label",24)(40,"input",25),v("change",function(u){g(e);let s=c();return _(s.onLettreSelected(u))}),r(),l(41," \u{1F4CE} Remplacer la lettre de motivation (facultatif) "),r(),p(42,pe,2,1,"p",26)(43,me,2,0,"button",27)(44,fe,4,1,"div",28)(45,ve,2,1,"div",22),r(),f(46,"br")(47,"br"),r()}if(t&2){let e,o,u=F(32),s=c();a(),d("ngIf",s.authService.isAdmin()),a(),d("ngIf",s.authService.isAdmin()),a(),d("ngIf",s.authService.isAdmin()&&((e=s.candidatureForm.get("etudiantId"))==null?null:e.invalid)&&((e=s.candidatureForm.get("etudiantId"))==null?null:e.touched)),a(8),d("ngForOf",s.stages),a(),d("ngIf",((o=s.candidatureForm.get("stageId"))==null?null:o.invalid)&&((o=s.candidatureForm.get("stageId"))==null?null:o.touched)),a(18),d("ngIf",s.selectedFile)("ngIfElse",u),a(3),d("ngIf",s.selectedFile),a(),d("ngIf",s.pdfPreviewUrl),a(),d("ngIf",s.cvError),a(7),d("ngIf",s.lettreMotivationFile),a(),d("ngIf",s.lettreMotivationFile),a(),d("ngIf",s.lettreMotivationPreviewUrl),a(),d("ngIf",s.cvError)}}function _e(t,i){if(t&1&&(n(0,"option",31),l(1),r()),t&2){let e=i.$implicit;d("value",e),a(),x(" ",e," ")}}function he(t,i){t&1&&(n(0,"span"),l(1,"\u274C Le statut est requis."),r())}function xe(t,i){if(t&1&&(n(0,"div",32),p(1,he,2,0,"span",2),r()),t&2){let e,o=c(2);a(),d("ngIf",(e=o.candidatureForm.get("statut"))==null||e.errors==null?null:e.errors.required)}}function Ce(t,i){if(t&1&&(n(0,"div")(1,"label",42),l(2,"Modifier le statut :"),r(),n(3,"select",43)(4,"option",10),l(5,"-- Choisissez un statut --"),r(),p(6,_e,2,2,"option",11)(7,xe,2,1,"div",7),r(),f(8,"br")(9,"br"),r()),t&2){let e,o=c();a(6),d("ngForOf",o.statuts),a(),d("ngIf",((e=o.candidatureForm.get("statut"))==null?null:e.invalid)&&((e=o.candidatureForm.get("statut"))==null?null:e.touched))}}var X=class t{constructor(i,e,o,u,s,I,be,Ee,Se){this.sanitizer=i;this.authService=e;this.fb=o;this.candidatureService=u;this.stageService=s;this.etudiantService=I;this.route=be;this.router=Ee;this.alertService=Se;this.candidatureForm=this.fb.group({etudiantId:["",S.required],stageId:["",S.required],dateCandidature:[""],dateDisponibilite:[""],statut:[""],message:[""]})}candidatureForm;candidatureId;stages=[];etudiants=[];statuts=["EN_ATTENTE","ACCEPTEE","REFUSEE"];message="";messageType="";selectedFile=null;cvError=!1;pdfPreviewUrl=null;cvErrorMessage="";lettreMotivationFile=null;lettreMotivationPreviewUrl=null;lettreError=!1;lettreErrorMessage="";ngOnInit(){this.candidatureId=Number(this.route.snapshot.paramMap.get("id")),this.candidatureId&&(this.pdfPreviewUrl=this.sanitizer.bypassSecurityTrustResourceUrl(`http://localhost:8080/api/candidatures/${this.candidatureId}/download-cv`),this.candidatureService.getCandidatureById(this.candidatureId).subscribe(i=>{this.candidatureForm.patchValue({etudiantId:i?.etudiant.id,stageId:i?.stage.id,dateCandidature:i?.dateCandidature,dateDisponibilite:i?.dateDisponibilite,statut:i?.statut,message:i?.message}),i?.lettreMotivationFilename&&(this.lettreMotivationPreviewUrl=this.sanitizer.bypassSecurityTrustResourceUrl(`http://localhost:8080/api/candidatures/${this.candidatureId}/download-lettre`))})),this.stageService.getAllStages().subscribe({next:i=>this.stages=i,error:i=>console.error("Erreur lors du chargement des stages",i)}),this.etudiantService.getAllEtudiants().subscribe({next:i=>this.etudiants=i,error:i=>console.error("Erreur lors du chargement des \xE9tudiants",i)})}onFileSelected(i){let e=i.target.files[0];if(!e){this.selectedFile=null,this.pdfPreviewUrl=null,this.cvError=!0,this.cvErrorMessage="\u26A0\uFE0F Le CV est obligatoire pour postuler.";return}if(e.type!=="application/pdf"){this.selectedFile=null,this.pdfPreviewUrl=null,this.cvError=!0,this.cvErrorMessage="\u274C Seuls les fichiers PDF sont autoris\xE9s.";return}let o=2*1024*1024;if(e.size>o){this.selectedFile=null,this.pdfPreviewUrl=null,this.cvError=!0,this.cvErrorMessage="\u274C Le fichier d\xE9passe la taille maximale de 2 Mo.";return}this.selectedFile=e,this.cvError=!1,this.cvErrorMessage="";let u=new FileReader;u.onload=s=>{let I=s.target.result;this.pdfPreviewUrl=this.sanitizer.bypassSecurityTrustResourceUrl(I)},u.readAsDataURL(e)}removeSelectedFile(){this.selectedFile=null,this.cvError=!1,this.pdfPreviewUrl=this.sanitizer.bypassSecurityTrustResourceUrl(`http://localhost:8080/api/candidatures/${this.candidatureId}/download-cv`);let i=document.getElementById("cv-upload");i&&(i.value="")}onLettreSelected(i){let e=i.target.files[0];if(this.lettreError=!1,this.lettreErrorMessage="",e){if(!e.name.endsWith(".pdf")){this.lettreError=!0,this.lettreErrorMessage="\u274C Seuls les fichiers PDF sont autoris\xE9s.";return}if(e.size>2*1024*1024){this.lettreError=!0,this.lettreErrorMessage="\u274C Le fichier doit faire moins de 2 Mo.";return}this.lettreMotivationFile=e;let o=new FileReader;o.onload=()=>{let u=new Blob([o.result],{type:"application/pdf"}),s=URL.createObjectURL(u);this.lettreMotivationPreviewUrl=this.sanitizer.bypassSecurityTrustResourceUrl(s)},o.readAsArrayBuffer(e)}}clearLettreMotivation(){this.lettreMotivationFile=null,this.lettreError=!1,this.lettreMotivationPreviewUrl=this.sanitizer.bypassSecurityTrustResourceUrl(`http://localhost:8080/api/candidatures/${this.candidatureId}/download-lettre`)}onSubmit(){if(this.cvError=!1,this.lettreError=!1,this.candidatureForm.valid&&this.candidatureId){let i={etudiant:{id:this.candidatureForm.value.etudiantId},stage:{id:this.candidatureForm.value.stageId},dateCandidature:this.candidatureForm.value.dateCandidature,dateDisponibilite:this.candidatureForm.value.dateDisponibilite,statut:this.candidatureForm.value.statut,message:this.candidatureForm.value.message};this.candidatureService.updateCandidature(this.candidatureId,i).subscribe({next:e=>{this.selectedFile&&this.lettreMotivationFile?this.candidatureService.updateFiles(e.id,this.selectedFile,this.lettreMotivationFile).subscribe({next:()=>{this.messageType="success",this.message="\u2705 Candidature modifi\xE9e avec succ\xE8s !",this.alertService.success(this.message).then(()=>{this.router.navigate(["/candidatures",this.candidatureId])})},error:()=>{this.messageType="error",this.message="\u274C Candidature modifi\xE9e avec succ\xE8s, mais l\u2019upload du CV a \xE9chou\xE9.",this.alertService.error(this.message)}}):(this.messageType="success",this.message="\u2705 Candidature modifi\xE9e avec succ\xE8s !",this.alertService.success(this.message).then(()=>{this.router.navigate(["/candidatures",this.candidatureId])}))},error:e=>{console.error("Erreur lors de la modification de la candidature",e),this.messageType="error",this.message="\u274C Erreur lors de la modiafication de la candidature.",this.alertService.error(this.message)}})}else this.messageType="error",this.message="\u26A0\uFE0F Merci de compl\xE9ter le formulaire correctement.",this.alertService.error(this.message)}annuler(){this.messageType="error",this.message="\u274C Ete vous sur de vouloir annuler les modifications ?",this.alertService.confirm(this.message).then(i=>{i.isConfirmed&&this.router.navigate(["/candidatures",this.candidatureId])})}static \u0275fac=function(e){return new(e||t)(m(O),m(D),m(G),m(J),m(K),m(Q),m(U),m(k),m(W))};static \u0275cmp=y({type:t,selectors:[["app-candidature-edit"]],decls:9,vars:4,consts:[["noFile",""],[3,"ngSubmit","formGroup"],[4,"ngIf"],["type","submit",3,"disabled"],["type","button",3,"click"],["for","etudiantId",4,"ngIf"],["formControlName","etudiantId","required","",4,"ngIf"],["class","error",4,"ngIf"],["for","stageId"],["formControlName","stageId","required",""],["value",""],[3,"value",4,"ngFor","ngForOf"],["type","date","formControlName","dateDisponibilite"],["for","message"],["formControlName","message","rows","4","cols","50"],[1,"file-upload"],["for","cv-upload",1,"upload-label"],["type","file","id","cv-upload","accept",".pdf","hidden","",3,"change"],[1,"upload-display"],[4,"ngIf","ngIfElse"],["class","delete-file-btn",3,"click",4,"ngIf"],["class","pdf-preview",4,"ngIf"],["class","cv-error",4,"ngIf"],[1,"upload-section"],[1,"custom-upload"],["type","file","accept","application/pdf","hidden","",3,"change"],["class","file-info",4,"ngIf"],["class","delete-file-btn","type","button",3,"click",4,"ngIf"],["class","preview-box",4,"ngIf"],["for","etudiantId"],["formControlName","etudiantId","required",""],[3,"value"],[1,"error"],[1,"no-file"],[1,"delete-file-btn",3,"click"],[1,"pdf-preview"],["width","100%","height","400px",3,"src",4,"ngIf"],["width","100%","height","400px",3,"src"],[1,"cv-error"],[1,"file-info"],["type","button",1,"delete-file-btn",3,"click"],[1,"preview-box"],["for","statut"],["formControlName","statut","required",""]],template:function(e,o){e&1&&(n(0,"h2"),l(1,"Modifier une Candidature"),r(),n(2,"form",1),v("ngSubmit",function(){return o.onSubmit()}),p(3,ge,48,14,"div",2)(4,Ce,10,2,"div",2),n(5,"button",3),l(6,"Enregistrer"),r(),n(7,"button",4),v("click",function(){return o.annuler()}),l(8,"Annuler"),r()()),e&2&&(a(2),d("formGroup",o.candidatureForm),a(),d("ngIf",!o.authService.isEntreprise()),a(),d("ngIf",o.authService.isEntreprise()),a(),d("disabled",o.candidatureForm.invalid))},dependencies:[T,w,P,H,V,j,B,R,L,A,z,$,N,q],styles:["form[_ngcontent-%COMP%]{max-width:600px;margin:50px auto;padding:30px;background:#fff;border-radius:8px;box-shadow:0 0 10px #0000001a}input[_ngcontent-%COMP%], select[_ngcontent-%COMP%], textarea[_ngcontent-%COMP%]{width:100%;padding:10px 15px;margin:10px 0 20px;border:1px solid #ccc;border-radius:5px;font-size:1rem}label[_ngcontent-%COMP%]{font-weight:700;display:block;margin-bottom:5px}button[_ngcontent-%COMP%]{padding:10px 20px;margin-right:10px;background-color:#007bff;color:#fff;border:none;border-radius:6px;cursor:pointer;font-size:1rem;transition:background-color .3s}button[_ngcontent-%COMP%]:hover{background-color:#0056b3}button[type=button][_ngcontent-%COMP%]{background-color:#6c757d}button[type=button][_ngcontent-%COMP%]:hover{background-color:#565e64}h2[_ngcontent-%COMP%]{text-align:center;margin-bottom:30px;color:#333}.error[_ngcontent-%COMP%]{color:red;margin-bottom:10px}.file-upload[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.5rem;margin-bottom:1.5rem}.upload-label[_ngcontent-%COMP%]{background-color:#007bff;color:#fff;padding:10px 15px;border-radius:5px;cursor:pointer;font-weight:700;width:fit-content;transition:background-color .3s ease}.upload-label[_ngcontent-%COMP%]:hover{background-color:#0056b3}.upload-display[_ngcontent-%COMP%]{font-style:italic;color:#555;font-size:.9rem}.no-file[_ngcontent-%COMP%]{color:#888}.cv-error[_ngcontent-%COMP%]{color:#dc3545;font-weight:500;font-size:.9rem}.pdf-preview[_ngcontent-%COMP%]{margin-top:1rem;border:1px solid #ccc;border-radius:6px;overflow:hidden;box-shadow:0 2px 8px #0000001a}.delete-file-btn[_ngcontent-%COMP%]{background-color:#dc3545;color:#fff;font-weight:700;border:none;border-radius:5px;padding:6px 12px;margin-top:.5rem;width:fit-content;cursor:pointer;transition:background-color .3s ease}.delete-file-btn[_ngcontent-%COMP%]:hover{background-color:#b02a37}.upload-section[_ngcontent-%COMP%]{margin-top:20px;display:flex;flex-direction:column;gap:10px}.custom-upload[_ngcontent-%COMP%]{display:inline-block;background-color:#6c757d;color:#fff;font-weight:700;padding:10px 20px;border-radius:5px;cursor:pointer;width:fit-content;transition:background-color .3s ease}.custom-upload[_ngcontent-%COMP%]:hover{background-color:#5a6268}.file-info[_ngcontent-%COMP%]{font-style:italic;color:#333;margin:0}.clear-btn[_ngcontent-%COMP%]{background-color:transparent;color:red;border:none;cursor:pointer;font-size:.9rem;width:fit-content;padding:2px}.clear-btn[_ngcontent-%COMP%]:hover{text-decoration:underline}.preview-box[_ngcontent-%COMP%]{border:1px solid #ccc;padding:10px;border-radius:4px;background-color:#f8f9fa}"]})};export{X as CandidatureEditComponent};
