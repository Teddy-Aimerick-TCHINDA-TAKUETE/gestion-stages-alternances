import{a as V}from"./chunk-K3IUYF2E.js";import{a as R}from"./chunk-4T322RVL.js";import{$ as y,A as S,B as c,D as a,R as w,T as F,Z as I,da as P,ea as T,fa as d,ga as q,ha as A,ja as M,ka as N,la as O,n as o,p as v,pa as L,q as C,qa as k,s as m,sa as W,t as l,ta as j,u as n,v as s,w as u}from"./chunk-XPQBKRV7.js";function U(e,i){e&1&&(n(0,"span"),a(1,"\u274C Le nom est requis."),s())}function D(e,i){if(e&1&&(n(0,"div",14),m(1,U,2,0,"span",8),s()),e&2){let r,t=c();o(),l("ngIf",(r=t.entrepriseForm.get("nom"))==null||r.errors==null?null:r.errors.required)}}function B(e,i){e&1&&(n(0,"span"),a(1,"\u274C L'email est requis."),s())}function z(e,i){e&1&&(n(0,"span"),a(1,"\u274C L'email n'est pas valide."),s())}function H(e,i){if(e&1&&(n(0,"div",14),m(1,B,2,0,"span",8)(2,z,2,0,"span",8),s()),e&2){let r,t,p=c();o(),l("ngIf",(r=p.entrepriseForm.get("email"))==null||r.errors==null?null:r.errors.required),o(),l("ngIf",(t=p.entrepriseForm.get("email"))==null||t.errors==null?null:t.errors.email)}}function J(e,i){e&1&&(n(0,"span"),a(1,"\u274C Le numero de telephone est requis."),s())}function K(e,i){if(e&1&&(n(0,"div",14),m(1,J,2,0,"span",8),s()),e&2){let r,t=c();o(),l("ngIf",(r=t.entrepriseForm.get("telephone"))==null||r.errors==null?null:r.errors.required)}}function Q(e,i){e&1&&(n(0,"span"),a(1,"\u274C L'adresse est requis."),s())}function X(e,i){if(e&1&&(n(0,"div",14),m(1,Q,2,0,"span",8),s()),e&2){let r,t=c();o(),l("ngIf",(r=t.entrepriseForm.get("adresse"))==null||r.errors==null?null:r.errors.required)}}function Y(e,i){e&1&&(n(0,"span"),a(1,"\u274C Le site web est requis."),s())}function Z(e,i){if(e&1&&(n(0,"div",14),m(1,Y,2,0,"span",8),s()),e&2){let r,t=c();o(),l("ngIf",(r=t.entrepriseForm.get("siteWeb"))==null||r.errors==null?null:r.errors.required)}}function $(e,i){e&1&&(n(0,"span"),a(1,"\u274C Le secteur d'activite est requis."),s())}function ee(e,i){if(e&1&&(n(0,"div",14),m(1,$,2,0,"span",8),s()),e&2){let r,t=c();o(),l("ngIf",(r=t.entrepriseForm.get("secteurActivite"))==null||r.errors==null?null:r.errors.required)}}function te(e,i){e&1&&(n(0,"label"),a(1,"Ancien mot de passe :"),s())}function re(e,i){e&1&&u(0,"input",15)}function ie(e,i){e&1&&(n(0,"span"),a(1,"\u274C L'ancien mot de passe est requis."),s())}function ne(e,i){if(e&1&&(n(0,"div",14),m(1,ie,2,0,"span",8),s()),e&2){let r,t=c();o(),l("ngIf",!t.authService.isAdmin()&&((r=t.entrepriseForm.get("oldPassword"))==null||r.errors==null?null:r.errors.required))}}function se(e,i){e&1&&(n(0,"span"),a(1,"\u274C Le nouveau mot de passe est requis."),s())}function oe(e,i){if(e&1&&(n(0,"div",14),m(1,se,2,0,"span",8),s()),e&2){let r,t=c();o(),l("ngIf",(r=t.entrepriseForm.get("newPassword"))==null||r.errors==null?null:r.errors.required)}}function le(e,i){e&1&&(n(0,"div"),a(1," \u274C Les deux nouveaux mots de passe ne correspondent pas. "),s())}var G=class e{constructor(i,r,t,p,f,_,h){this.authService=i;this.fb=r;this.entrepriseService=t;this.route=p;this.router=f;this.userService=_;this.alertService=h;this.entrepriseForm=this.fb.group({nom:["",d.required],email:["",[d.required,d.email]],telephone:["",d.required],adresse:["",d.required],siteWeb:["",d.required],secteurActivite:["",d.required],password:["",d.required],oldPassword:["",d.required],newPassword:["",d.required],confirmPassword:["",d.required],user:[]},{validators:this.passwordsMatchValidator})}entrepriseForm;entrepriseId;userId;message="";messageType="";passwordsMatchValidator(i){let r=i.get("newPassword")?.value,t=i.get("confirmPassword")?.value;return r===t?null:{passwordMismatch:!0}}ngOnInit(){this.entrepriseId=Number(this.route.snapshot.paramMap.get("id")),this.entrepriseId&&this.entrepriseService.getEntrepriseById(this.entrepriseId).subscribe(i=>{this.entrepriseForm.patchValue({nom:i?.nom,email:i?.user.email,telephone:i?.telephone,adresse:i?.adresse,siteWeb:i?.siteWeb,secteurActivite:i?.secteurActivite,password:i?.user.password,user:i?.user}),this.authService.isAdmin()&&this.entrepriseForm.patchValue({oldPassword:i?.user.password}),this.userId=i?.user.id})}onSubmit(){if(this.entrepriseForm.valid&&this.entrepriseId&&this.userId){if(this.entrepriseForm.hasError("passwordMismatch")){this.messageType="error",this.message="\u274C Les nouveaux mots de passe ne correspondent pas.",this.alertService.error(this.message);return}let i={oldPassword:this.entrepriseForm.value.oldPassword,newPassword:this.entrepriseForm.value.newPassword};this.entrepriseForm.value.password=this.entrepriseForm.value.newPassword,this.entrepriseForm.value.user.email=this.entrepriseForm.value.email,this.entrepriseForm.value.user.password=this.entrepriseForm.value.password;let r={email:this.entrepriseForm.value.email,password:this.entrepriseForm.value.Password},t={id:this.entrepriseId,nom:this.entrepriseForm.value.nom,telephone:this.entrepriseForm.value.telephone,adresse:this.entrepriseForm.value.adresse,siteWeb:this.entrepriseForm.value.siteWeb,secteurActivite:this.entrepriseForm.value.secteurActivite,user:this.entrepriseForm.value.user};this.authService.isAdmin()?(console.log("Ohay a ce niveau!"),this.userId&&this.userService.updateUser(this.userId,r).subscribe({next:()=>{},error:p=>{console.error("Erreur lors de la mise \xE0 jour du user",p)}}),this.entrepriseId&&this.entrepriseService.updateEntreprise(this.entrepriseId,t).subscribe({next:()=>{this.messageType="success",this.message="\u2705 Entreprise modifi\xE9e avec succ\xE8s !",this.alertService.success(this.message).then(()=>{this.router.navigate(["/entreprises",this.entrepriseId])})},error:p=>{console.error("Erreur lors de la modification de l'entreprise",p),this.messageType="error",this.message="\u274C Erreur lors de la modification de l'entreprise.",this.alertService.error(this.message)}})):this.userService.verifyPassword(this.userId,this.entrepriseForm.value.oldPassword).subscribe({next:()=>{this.userId&&this.userService.updateUser(this.userId,r).subscribe({next:()=>{},error:p=>{console.error("Erreur lors de la mise \xE0 jour du user",p)}}),this.entrepriseId&&this.entrepriseService.updateEntreprise(this.entrepriseId,t).subscribe({next:()=>{this.messageType="success",this.message="\u2705 Entreprise modifi\xE9e avec succ\xE8s !",this.alertService.success(this.message).then(()=>{this.router.navigate(["/entreprises",this.entrepriseId])})},error:p=>{console.error("Erreur lors de la modification de l'entreprise",p),this.messageType="error",this.message="\u274C Erreur lors de la modification de l'entreprise.",this.alertService.error(this.message)}})},error:()=>{this.messageType="error",this.message="\u274C Ancien mot de passe incorrect.",this.alertService.error(this.message)}})}else this.messageType="error",this.message="\u26A0\uFE0F Merci de compl\xE9ter le formulaire correctement.",this.alertService.error(this.message)}annuler(){this.messageType="error",this.message="\u274C Ete vous sur de vouloir annuler les modifications ?",this.alertService.confirm(this.message).then(i=>{i.isConfirmed&&this.router.navigate(["/entreprises",this.entrepriseId])})}static \u0275fac=function(r){return new(r||e)(v(P),v(k),v(V),v(I),v(y),v(R),v(j))};static \u0275cmp=C({type:e,selectors:[["app-entreprise-edit"]],decls:42,vars:13,consts:[[3,"ngSubmit","formGroup"],["type","text","formControlName","nom"],["class","error",4,"ngIf"],["type","email","autocomplete","email","formControlName","email"],["type","text","formControlName","telephone"],["type","text","formControlName","adresse"],["type","url","formControlName","siteWeb"],["type","text","formControlName","secteurActivite"],[4,"ngIf"],["type","password","autocomplete","current-password","formControlName","oldPassword","required","",4,"ngIf"],["type","password","autocomplete","current-password","formControlName","newPassword","required",""],["type","password","autocomplete","current-password","formControlName","confirmPassword","required",""],["type","submit",3,"disabled"],["type","button",3,"click"],[1,"error"],["type","password","autocomplete","current-password","formControlName","oldPassword","required",""]],template:function(r,t){if(r&1&&(n(0,"h2"),a(1,"Modifier une Entreprise"),s(),n(2,"form",0),S("ngSubmit",function(){return t.onSubmit()}),n(3,"label"),a(4,"Nom :"),s(),u(5,"input",1),m(6,D,2,1,"div",2),n(7,"label"),a(8,"Email :"),s(),u(9,"input",3),m(10,H,3,2,"div",2),n(11,"label"),a(12,"T\xE9l\xE9phone :"),s(),u(13,"input",4),m(14,K,2,1,"div",2),n(15,"label"),a(16,"Adresse :"),s(),u(17,"input",5),m(18,X,2,1,"div",2),n(19,"label"),a(20,"Site Web :"),s(),u(21,"input",6),m(22,Z,2,1,"div",2),n(23,"label"),a(24,"Secteur d'activit\xE9 :"),s(),u(25,"input",7),m(26,ee,2,1,"div",2)(27,te,2,0,"label",8)(28,re,1,0,"input",9)(29,ne,2,1,"div",2),n(30,"label"),a(31,"Nouveau mot de passe :"),s(),u(32,"input",10),m(33,oe,2,1,"div",2),n(34,"label"),a(35,"Confirmation du nouveau mot de passe :"),s(),u(36,"input",11),m(37,le,2,0,"div",8),n(38,"button",12),a(39,"Enregistrer"),s(),n(40,"button",13),S("click",function(){return t.annuler()}),a(41,"Annuler"),s()()),r&2){let p,f,_,h,g,E,b,x;o(2),l("formGroup",t.entrepriseForm),o(4),l("ngIf",((p=t.entrepriseForm.get("nom"))==null?null:p.invalid)&&((p=t.entrepriseForm.get("nom"))==null?null:p.touched)),o(4),l("ngIf",((f=t.entrepriseForm.get("email"))==null?null:f.invalid)&&((f=t.entrepriseForm.get("email"))==null?null:f.touched)),o(4),l("ngIf",((_=t.entrepriseForm.get("telephone"))==null?null:_.invalid)&&((_=t.entrepriseForm.get("telephone"))==null?null:_.touched)),o(4),l("ngIf",((h=t.entrepriseForm.get("adresse"))==null?null:h.invalid)&&((h=t.entrepriseForm.get("adresse"))==null?null:h.touched)),o(4),l("ngIf",((g=t.entrepriseForm.get("siteWeb"))==null?null:g.invalid)&&((g=t.entrepriseForm.get("siteWeb"))==null?null:g.touched)),o(4),l("ngIf",((E=t.entrepriseForm.get("secteurActivite"))==null?null:E.invalid)&&((E=t.entrepriseForm.get("secteurActivite"))==null?null:E.touched)),o(),l("ngIf",!t.authService.isAdmin()),o(),l("ngIf",!t.authService.isAdmin()),o(),l("ngIf",!t.authService.isAdmin()&&((b=t.entrepriseForm.get("oldPassword"))==null?null:b.invalid)&&((b=t.entrepriseForm.get("oldPassword"))==null?null:b.touched)),o(4),l("ngIf",((x=t.entrepriseForm.get("newPassword"))==null?null:x.invalid)&&((x=t.entrepriseForm.get("newPassword"))==null?null:x.touched)),o(4),l("ngIf",t.entrepriseForm.hasError("passwordMismatch")),o(),l("disabled",t.entrepriseForm.invalid)}},dependencies:[F,w,W,M,T,q,A,L,N,O],styles:["form[_ngcontent-%COMP%]{max-width:600px;margin:50px auto;padding:30px;background:#fff;border-radius:8px;box-shadow:0 0 10px #0000001a}input[_ngcontent-%COMP%], select[_ngcontent-%COMP%], textarea[_ngcontent-%COMP%]{width:100%;padding:10px 15px;margin:10px 0 20px;border:1px solid #ccc;border-radius:5px;font-size:1rem}label[_ngcontent-%COMP%]{font-weight:700;display:block;margin-bottom:5px}button[_ngcontent-%COMP%]{padding:10px 20px;margin-right:10px;background-color:#007bff;color:#fff;border:none;border-radius:6px;cursor:pointer;font-size:1rem;transition:background-color .3s}button[_ngcontent-%COMP%]:hover{background-color:#0056b3}button[type=button][_ngcontent-%COMP%]{background-color:#6c757d}button[type=button][_ngcontent-%COMP%]:hover{background-color:#565e64}h2[_ngcontent-%COMP%]{text-align:center;margin-bottom:30px;color:#333}.error[_ngcontent-%COMP%]{color:red;margin-bottom:10px}"]})};export{G as EntrepriseEditComponent};
