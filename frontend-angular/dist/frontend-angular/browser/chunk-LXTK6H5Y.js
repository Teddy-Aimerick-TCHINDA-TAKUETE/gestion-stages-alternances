import{a as k}from"./chunk-UIHDUBTM.js";import{a as L}from"./chunk-4T322RVL.js";import{$ as F,A as x,B as v,D as m,R as b,T as w,Z as I,da as A,ea as y,fa as u,ga as P,ha as T,ja as M,ka as q,la as N,n as s,p as c,pa as R,q as E,qa as U,s as l,sa as O,t as a,ta as D,u as n,v as o,w as p}from"./chunk-XPQBKRV7.js";function V(e,r){e&1&&(n(0,"span"),m(1,"\u274C Le nom est requis."),o())}function G(e,r){if(e&1&&(n(0,"div",13),l(1,V,2,0,"span",7),o()),e&2){let i,t=v();s(),a("ngIf",(i=t.adminForm.get("nom"))==null||i.errors==null?null:i.errors.required)}}function B(e,r){e&1&&(n(0,"span"),m(1,"\u274C Le prenom est requis."),o())}function z(e,r){if(e&1&&(n(0,"div",13),l(1,B,2,0,"span",7),o()),e&2){let i,t=v();s(),a("ngIf",(i=t.adminForm.get("prenom"))==null||i.errors==null?null:i.errors.required)}}function H(e,r){e&1&&(n(0,"span"),m(1,"\u274C L'email est requis."),o())}function J(e,r){e&1&&(n(0,"span"),m(1,"\u274C L'email n'est pas valide."),o())}function K(e,r){if(e&1&&(n(0,"div",13),l(1,H,2,0,"span",7)(2,J,2,0,"span",7),o()),e&2){let i,t,d=v();s(),a("ngIf",(i=d.adminForm.get("email"))==null||i.errors==null?null:i.errors.required),s(),a("ngIf",(t=d.adminForm.get("email"))==null||t.errors==null?null:t.errors.email)}}function Q(e,r){e&1&&(n(0,"span"),m(1,"\u274C Le numero de telephone est requis."),o())}function W(e,r){if(e&1&&(n(0,"div",13),l(1,Q,2,0,"span",7),o()),e&2){let i,t=v();s(),a("ngIf",(i=t.adminForm.get("telephone"))==null||i.errors==null?null:i.errors.required)}}function X(e,r){e&1&&(n(0,"span"),m(1,"\u274C L'adresse est requis."),o())}function Y(e,r){if(e&1&&(n(0,"div",13),l(1,X,2,0,"span",7),o()),e&2){let i,t=v();s(),a("ngIf",(i=t.adminForm.get("adresse"))==null||i.errors==null?null:i.errors.required)}}function Z(e,r){e&1&&(n(0,"label"),m(1,"Ancien mot de passe :"),o())}function $(e,r){e&1&&p(0,"input",14)}function ee(e,r){e&1&&(n(0,"span"),m(1,"\u274C L'ancien mot de passe est requis."),o())}function te(e,r){if(e&1&&(n(0,"div",13),l(1,ee,2,0,"span",7),o()),e&2){let i,t=v();s(),a("ngIf",t.authService.getCurrentUserRole()!=="SUPER_ADMIN"&&((i=t.adminForm.get("oldPassword"))==null||i.errors==null?null:i.errors.required))}}function ie(e,r){e&1&&(n(0,"span"),m(1,"\u274C Le nouveau mot de passe est requis."),o())}function re(e,r){if(e&1&&(n(0,"div",13),l(1,ie,2,0,"span",7),o()),e&2){let i,t=v();s(),a("ngIf",(i=t.adminForm.get("newPassword"))==null||i.errors==null?null:i.errors.required)}}function ne(e,r){e&1&&(n(0,"div"),m(1," \u274C Les deux nouveaux mots de passe ne correspondent pas. "),o())}var j=class e{constructor(r,i,t,d,f,h,_){this.authService=r;this.route=i;this.router=t;this.fb=d;this.adminService=f;this.userService=h;this.alertService=_;this.adminForm=this.fb.group({nom:["",u.required],prenom:["",u.required],email:["",[u.required,u.email]],telephone:["",u.required],adresse:["",u.required],password:["",u.required],oldPassword:["",u.required],newPassword:["",u.required],confirmPassword:["",u.required],user:[]},{validators:this.passwordsMatchValidator})}adminForm;adminId;userId;message="";messageType="";passwordsMatchValidator(r){let i=r.get("newPassword")?.value,t=r.get("confirmPassword")?.value;return i===t?null:{passwordMismatch:!0}}ngOnInit(){this.adminId=Number(this.route.snapshot.paramMap.get("id")),this.adminId&&this.adminService.getAdminById(this.adminId).subscribe(r=>{this.adminForm.patchValue({nom:r?.nom,prenom:r?.prenom,email:r?.user.email,telephone:r?.telephone,adresse:r?.adresse,password:r?.user.password,user:r?.user}),this.authService.getCurrentUserRole()==="SUPER_ADMIN"&&this.adminForm.patchValue({oldPassword:r?.user.password}),this.userId=r?.user.id})}onSubmit(){if(this.adminForm.valid&&this.adminId&&this.userId){if(this.adminForm.hasError("passwordMismatch")){this.messageType="error",this.message="\u274C Les nouveaux mots de passe ne correspondent pas.",this.alertService.error(this.message);return}let r={oldPassword:this.adminForm.value.oldPassword,newPassword:this.adminForm.value.newPassword};this.adminForm.value.password=this.adminForm.value.newPassword,this.adminForm.value.user.email=this.adminForm.value.email,this.adminForm.value.user.password=this.adminForm.value.password;let i={email:this.adminForm.value.email,password:this.adminForm.value.Password},t={id:this.adminId,nom:this.adminForm.value.nom,prenom:this.adminForm.value.prenom,telephone:this.adminForm.value.telephone,adresse:this.adminForm.value.adresse,user:this.adminForm.value.user};this.authService.getCurrentUserRole()==="SUPER_ADMIN"?(this.userId&&this.userService.updateUser(this.userId,i).subscribe({next:()=>{},error:d=>{console.error("Erreur lors de la mise \xE0 jour du user",d)}}),this.adminId&&this.adminService.updateAdmin(this.adminId,t).subscribe({next:()=>{this.messageType="success",this.message="\u2705 Admin modifi\xE9 avec succ\xE8s !",this.alertService.success(this.message).then(()=>{this.router.navigate(["/admins",this.adminId])})},error:d=>{console.error("Erreur lors de la modification de l'admin",d),this.messageType="error",this.message="\u274C Erreur lors de la modification de l'admin.",this.alertService.error(this.message)}})):this.userService.verifyPassword(this.userId,this.adminForm.value.oldPassword).subscribe({next:()=>{this.userId&&this.userService.updateUser(this.userId,i).subscribe({next:()=>{},error:d=>{console.error("Erreur lors de la mise \xE0 jour du user",d)}}),this.adminId&&this.adminService.updateAdmin(this.adminId,t).subscribe({next:()=>{this.messageType="success",this.message="\u2705 Admin modifi\xE9 avec succ\xE8s !",this.alertService.success(this.message).then(()=>{this.router.navigate(["/admins",this.adminId])})},error:d=>{console.error("Erreur lors de la modification de l'admin",d),this.messageType="error",this.message="\u274C Erreur lors de la modification de l'admin.",this.alertService.error(this.message)}})},error:d=>{console.error("Erreur lors de la modification de la verification du password",d),this.messageType="error",this.message="\u274C Ancien mot de passe incorrect.",this.alertService.error(this.message)}})}else this.messageType="error",this.message="\u26A0\uFE0F Merci de compl\xE9ter le formulaire correctement.",this.alertService.error(this.message)}annuler(){this.messageType="error",this.message="\u274C Ete vous sur de vouloir annuler les modifications ?",this.alertService.confirm(this.message).then(r=>{r.isConfirmed&&this.router.navigate(["/admins",this.adminId])})}static \u0275fac=function(i){return new(i||e)(c(A),c(I),c(F),c(U),c(k),c(L),c(D))};static \u0275cmp=E({type:e,selectors:[["app-admin-edit"]],decls:38,vars:12,consts:[[3,"ngSubmit","formGroup"],["type","text","formControlName","nom"],["class","error",4,"ngIf"],["type","text","formControlName","prenom"],["type","email","autocomplete","email","formControlName","email"],["type","text","formControlName","telephone"],["type","text","formControlName","adresse"],[4,"ngIf"],["type","password","autocomplete","current-password","formControlName","oldPassword","required","",4,"ngIf"],["type","password","autocomplete","current-password","formControlName","newPassword","required",""],["type","password","autocomplete","current-password","formControlName","confirmPassword","required",""],["type","submit",3,"disabled"],["type","button",3,"click"],[1,"error"],["type","password","autocomplete","current-password","formControlName","oldPassword","required",""]],template:function(i,t){if(i&1&&(n(0,"h2"),m(1,"Modifier un Admin"),o(),n(2,"form",0),x("ngSubmit",function(){return t.onSubmit()}),n(3,"label"),m(4,"Nom :"),o(),p(5,"input",1),l(6,G,2,1,"div",2),n(7,"label"),m(8,"Prenom :"),o(),p(9,"input",3),l(10,z,2,1,"div",2),n(11,"label"),m(12,"Email :"),o(),p(13,"input",4),l(14,K,3,2,"div",2),n(15,"label"),m(16,"T\xE9l\xE9phone :"),o(),p(17,"input",5),l(18,W,2,1,"div",2),n(19,"label"),m(20,"Adresse :"),o(),p(21,"input",6),l(22,Y,2,1,"div",2)(23,Z,2,0,"label",7)(24,$,1,0,"input",8)(25,te,2,1,"div",2),n(26,"label"),m(27,"Nouveau mot de passe :"),o(),p(28,"input",9),l(29,re,2,1,"div",2),n(30,"label"),m(31,"Confirmation du nouveau mot de passe :"),o(),p(32,"input",10),l(33,ne,2,0,"div",7),n(34,"button",11),m(35,"Enregistrer"),o(),n(36,"button",12),x("click",function(){return t.annuler()}),m(37,"Annuler"),o()()),i&2){let d,f,h,_,g,S,C;s(2),a("formGroup",t.adminForm),s(4),a("ngIf",((d=t.adminForm.get("nom"))==null?null:d.invalid)&&((d=t.adminForm.get("nom"))==null?null:d.touched)),s(4),a("ngIf",((f=t.adminForm.get("prenom"))==null?null:f.invalid)&&((f=t.adminForm.get("prenom"))==null?null:f.touched)),s(4),a("ngIf",((h=t.adminForm.get("email"))==null?null:h.invalid)&&((h=t.adminForm.get("email"))==null?null:h.touched)),s(4),a("ngIf",((_=t.adminForm.get("telephone"))==null?null:_.invalid)&&((_=t.adminForm.get("telephone"))==null?null:_.touched)),s(4),a("ngIf",((g=t.adminForm.get("adresse"))==null?null:g.invalid)&&((g=t.adminForm.get("adresse"))==null?null:g.touched)),s(),a("ngIf",t.authService.getCurrentUserRole()!=="SUPER_ADMIN"),s(),a("ngIf",t.authService.getCurrentUserRole()!=="SUPER_ADMIN"),s(),a("ngIf",t.authService.getCurrentUserRole()!=="SUPER_ADMIN"&&((S=t.adminForm.get("oldPassword"))==null?null:S.invalid)&&((S=t.adminForm.get("oldPassword"))==null?null:S.touched)),s(4),a("ngIf",((C=t.adminForm.get("newPassword"))==null?null:C.invalid)&&((C=t.adminForm.get("newPassword"))==null?null:C.touched)),s(4),a("ngIf",t.adminForm.hasError("passwordMismatch")),s(),a("disabled",t.adminForm.invalid)}},dependencies:[w,b,O,M,y,P,T,R,q,N],styles:["form[_ngcontent-%COMP%]{max-width:600px;margin:50px auto;padding:30px;background:#fff;border-radius:8px;box-shadow:0 0 10px #0000001a}input[_ngcontent-%COMP%], select[_ngcontent-%COMP%], textarea[_ngcontent-%COMP%]{width:100%;padding:10px 15px;margin:10px 0 20px;border:1px solid #ccc;border-radius:5px;font-size:1rem}label[_ngcontent-%COMP%]{font-weight:700;display:block;margin-bottom:5px}button[_ngcontent-%COMP%]{padding:10px 20px;margin-right:10px;background-color:#007bff;color:#fff;border:none;border-radius:6px;cursor:pointer;font-size:1rem;transition:background-color .3s}button[_ngcontent-%COMP%]:hover{background-color:#0056b3}button[type=button][_ngcontent-%COMP%]{background-color:#6c757d}button[type=button][_ngcontent-%COMP%]:hover{background-color:#565e64}h2[_ngcontent-%COMP%]{text-align:center;margin-bottom:30px;color:#333}.error[_ngcontent-%COMP%]{color:red;margin-bottom:10px}"]})};export{j as AdminEditComponent};
