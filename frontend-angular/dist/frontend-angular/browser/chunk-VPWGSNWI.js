import{a as W}from"./chunk-BBH67TY2.js";import{a as Q}from"./chunk-A4HBSWL7.js";import{a as K}from"./chunk-BYWXCTMR.js";import{$ as U,A as _,B as c,C as M,D as s,E as x,F as S,G as F,O as y,Q as w,R as P,T as O,Y as T,Z as D,da as k,ea as V,fa as E,g as v,ga as A,h,ha as R,ja as z,ka as N,l as C,la as L,ma as q,n as a,na as j,oa as B,p,pa as G,q as I,qa as J,s as m,sa as $,t as l,ta as H,u as o,v as n,w as f,z as b}from"./chunk-XPQBKRV7.js";function Y(t,i){t&1&&(o(0,"label",27),s(1,"S\xE9lectionner votre nom :"),n())}function Z(t,i){if(t&1&&(o(0,"option",29),s(1),n()),t&2){let e=i.$implicit;l("value",e.id),a(),F(" ",e.prenom," ",e.nom," ")}}function ee(t,i){if(t&1&&(o(0,"select",28)(1,"option",7),s(2,"-- S\xE9lectionnez votre profil --"),n(),m(3,Z,2,3,"option",8),n()),t&2){let e=c();a(3),l("ngForOf",e.etudiants)}}function te(t,i){t&1&&(o(0,"span"),s(1,"\u274C L'etudiant est requis."),n())}function ie(t,i){if(t&1&&(o(0,"div",30),m(1,te,2,0,"span",31),n()),t&2){let e,r=c();a(),l("ngIf",(e=r.candidatureForm.get("etudiantId"))==null||e.errors==null?null:e.errors.required)}}function re(t,i){if(t&1&&(o(0,"option",29),s(1),n()),t&2){let e=i.$implicit;l("value",e.id),a(),F(" ",e.titre," (",e.type,") ")}}function ne(t,i){t&1&&(o(0,"span"),s(1,"\u274C Le stage/alternance est requis."),n())}function oe(t,i){if(t&1&&(o(0,"div",30),m(1,ne,2,0,"span",31),n()),t&2){let e,r=c();a(),l("ngIf",(e=r.candidatureForm.get("stageId"))==null||e.errors==null?null:e.errors.required)}}function ae(t,i){if(t&1&&(o(0,"span"),s(1),n()),t&2){let e=c();a(),x(e.selectedFile.name)}}function le(t,i){t&1&&(o(0,"span",32),s(1,"Aucun fichier s\xE9lectionn\xE9"),n())}function se(t,i){if(t&1){let e=b();o(0,"button",33),_("click",function(){v(e);let d=c();return h(d.removeSelectedFile())}),s(1," \u274C Supprimer le fichier "),n()}}function de(t,i){if(t&1&&f(0,"iframe",36),t&2){let e=c(2);l("src",e.pdfPreviewUrl,C)}}function ce(t,i){if(t&1&&(o(0,"div",34)(1,"label"),s(2,"\u{1F4C4} Aper\xE7u du CV :"),n(),m(3,de,1,1,"iframe",35),n()),t&2){let e=c();a(3),l("ngIf",e.pdfPreviewUrl)}}function ue(t,i){if(t&1&&(o(0,"div",37),s(1),n()),t&2){let e=c();a(),S(" ",e.cvErrorMessage," ")}}function me(t,i){if(t&1&&(o(0,"p",38),s(1),n()),t&2){let e=c();a(),x(e.lettreMotivationFile.name)}}function pe(t,i){if(t&1){let e=b();o(0,"button",39),_("click",function(){v(e);let d=c();return h(d.clearLettreMotivation())}),s(1," \u274C Supprimer le fichier "),n()}}function fe(t,i){if(t&1&&(o(0,"div",40)(1,"label"),s(2,"Aper\xE7u de la lettre :"),n(),f(3,"iframe",36),n()),t&2){let e=c();a(3),l("src",e.lettreMotivationPreviewUrl,C)}}function ge(t,i){if(t&1&&(o(0,"div",37),s(1),n()),t&2){let e=c();a(),S(" ",e.lettreErrorMessage," ")}}var X=class t{constructor(i,e,r,d,u,g,ve,he,_e){this.sanitizer=i;this.authService=e;this.fb=r;this.candidatureService=d;this.stageService=u;this.etudiantService=g;this.route=ve;this.router=he;this.alertService=_e;this.candidatureForm=this.fb.group({etudiantId:["",E.required],stageId:["",E.required],dateDisponibilite:[""],message:[""]})}candidatureForm;stageId;stages=[];etudiants=[];message="";messageType="";selectedFile=null;cvError=!1;pdfPreviewUrl=null;cvErrorMessage="";lettreMotivationFile=null;lettreMotivationPreviewUrl=null;lettreError=!1;lettreErrorMessage="";ngOnInit(){this.stageId=Number(this.route.snapshot.paramMap.get("id")),this.stageId&&this.stageService.getStageById(this.stageId).subscribe(i=>{this.candidatureForm.patchValue({stageId:i?.id})}),this.authService.getCurrentProfilId()&&this.authService.isEtudiant()&&this.candidatureForm.patchValue({etudiantId:this.authService.getCurrentProfilId()}),this.stageService.getAllStages().subscribe({next:i=>this.stages=i,error:i=>console.error("Erreur lors du chargement des stages",i)}),this.etudiantService.getAllEtudiants().subscribe({next:i=>this.etudiants=i,error:i=>console.error("Erreur lors du chargement des \xE9tudiants",i)})}onFileSelected(i){let e=i.target.files[0];if(!e){this.selectedFile=null,this.pdfPreviewUrl=null,this.cvError=!0,this.cvErrorMessage="\u26A0\uFE0F Le CV est obligatoire pour postuler.";return}if(e.type!=="application/pdf"){this.selectedFile=null,this.pdfPreviewUrl=null,this.cvError=!0,this.cvErrorMessage="\u274C Seuls les fichiers PDF sont autoris\xE9s.";return}let r=2*1024*1024;if(e.size>r){this.selectedFile=null,this.pdfPreviewUrl=null,this.cvError=!0,this.cvErrorMessage="\u274C Le fichier d\xE9passe la taille maximale de 2 Mo.";return}this.selectedFile=e,this.cvError=!1,this.cvErrorMessage="";let d=new FileReader;d.onload=u=>{let g=u.target.result;this.pdfPreviewUrl=this.sanitizer.bypassSecurityTrustResourceUrl(g)},d.readAsDataURL(e)}removeSelectedFile(){this.selectedFile=null,this.pdfPreviewUrl=null,this.cvError=!1;let i=document.getElementById("cv-upload");i&&(i.value="")}onLettreSelected(i){let e=i.target.files[0];if(this.lettreError=!1,this.lettreErrorMessage="",e){if(!e.name.endsWith(".pdf")){this.lettreError=!0,this.lettreErrorMessage="\u274C Seuls les fichiers PDF sont autoris\xE9s.";return}if(e.size>2*1024*1024){this.lettreError=!0,this.lettreErrorMessage="\u274C Le fichier doit faire moins de 2 Mo.";return}this.lettreMotivationFile=e;let r=new FileReader;r.onload=()=>{let d=new Blob([r.result],{type:"application/pdf"}),u=URL.createObjectURL(d);this.lettreMotivationPreviewUrl=this.sanitizer.bypassSecurityTrustResourceUrl(u)},r.readAsArrayBuffer(e)}}clearLettreMotivation(){this.lettreMotivationFile=null,this.lettreMotivationPreviewUrl=null,this.lettreError=!1}onSubmit(){if(!this.selectedFile){this.selectedFile=null,this.pdfPreviewUrl=null,this.cvError=!0,this.cvErrorMessage="\u26A0\uFE0F Le CV est obligatoire pour postuler.";return}if(this.cvError=!1,this.lettreError=!1,this.candidatureForm.valid){let i={etudiant:{id:this.candidatureForm.value.etudiantId},stage:{id:this.candidatureForm.value.stageId},dateDisponibilite:this.candidatureForm.value.dateDisponibilite,message:this.candidatureForm.value.message};this.candidatureService.createCandidature(i).subscribe({next:e=>{this.selectedFile&&this.lettreMotivationFile?this.candidatureService.updateFiles(e.id,this.selectedFile,this.lettreMotivationFile).subscribe({next:()=>{this.messageType="success",this.message="\u2705 Candidature envoy\xE9e avec succ\xE8s !",this.alertService.success(this.message).then(()=>{this.router.navigate(["/candidatures"])})},error:r=>{console.log("L'erreur est : ",r),this.messageType="error",this.message="\u274C Candidature envoy\xE9e, mais l\u2019upload du CV ou de la lettre de motivation a \xE9chou\xE9.",this.alertService.error(this.message)}}):(this.messageType="success",this.message="\u2705 Candidature envoy\xE9e avec succ\xE8s !",this.alertService.success(this.message).then(()=>{this.router.navigate(["/candidatures"])}))},error:e=>{console.error("Erreur lors de la cr\xE9ation de la candidature",e),this.messageType="error",this.message="\u274C Erreur lors de la cr\xE9ation de la candidature.",this.alertService.error(this.message)}})}else this.messageType="error",this.message="\u26A0\uFE0F Merci de compl\xE9ter le formulaire correctement.",this.alertService.error(this.message)}static \u0275fac=function(e){return new(e||t)(p(T),p(k),p(J),p(W),p(K),p(Q),p(D),p(U),p(H))};static \u0275cmp=I({type:t,selectors:[["app-candidature-form"]],decls:52,vars:16,consts:[["noFile",""],[3,"ngSubmit","formGroup"],["for","etudiantId",4,"ngIf"],["formControlName","etudiantId","required","",4,"ngIf"],["class","error",4,"ngIf"],["for","stageId"],["formControlName","stageId","required",""],["value",""],[3,"value",4,"ngFor","ngForOf"],["type","date","formControlName","dateDisponibilite"],["for","message"],["formControlName","message","rows","4","cols","50"],[1,"file-upload"],["for","cv-upload",1,"upload-label"],["type","file","id","cv-upload","accept",".pdf","hidden","",3,"change"],[1,"upload-display"],[4,"ngIf","ngIfElse"],["class","delete-file-btn",3,"click",4,"ngIf"],["class","pdf-preview",4,"ngIf"],["class","cv-error",4,"ngIf"],[1,"upload-section"],[1,"custom-upload"],["type","file","accept","application/pdf","hidden","",3,"change"],["class","file-info",4,"ngIf"],["class","delete-file-btn","type","button",3,"click",4,"ngIf"],["class","preview-box",4,"ngIf"],["type","submit",3,"disabled"],["for","etudiantId"],["formControlName","etudiantId","required",""],[3,"value"],[1,"error"],[4,"ngIf"],[1,"no-file"],[1,"delete-file-btn",3,"click"],[1,"pdf-preview"],["width","100%","height","400px",3,"src",4,"ngIf"],["width","100%","height","400px",3,"src"],[1,"cv-error"],[1,"file-info"],["type","button",1,"delete-file-btn",3,"click"],[1,"preview-box"]],template:function(e,r){if(e&1){let d=b();o(0,"h2"),s(1,"Cr\xE9er une candidature"),n(),o(2,"form",1),_("ngSubmit",function(){return v(d),h(r.onSubmit())}),m(3,Y,2,0,"label",2)(4,ee,4,1,"select",3)(5,ie,2,1,"div",4),f(6,"br")(7,"br"),o(8,"label",5),s(9,"S\xE9lectionner un stage/alternance :"),n(),o(10,"select",6)(11,"option",7),s(12,"-- Choisissez un stage --"),n(),m(13,re,2,3,"option",8),n(),m(14,oe,2,1,"div",4),f(15,"br")(16,"br"),o(17,"label"),s(18,"Date a partir de laquelle vous ete disponible :"),n(),f(19,"input",9)(20,"br")(21,"br"),o(22,"label",10),s(23,"Message (facultatif) :"),n(),f(24,"textarea",11)(25,"br")(26,"br"),o(27,"div",12)(28,"label",13),s(29," \u{1F4CE} Joindre un CV (PDF obligatoire) "),n(),o(30,"input",14),_("change",function(g){return v(d),h(r.onFileSelected(g))}),n(),o(31,"div",15),m(32,ae,2,1,"span",16)(33,le,2,0,"ng-template",null,0,y),n(),m(35,se,2,0,"button",17)(36,ce,4,1,"div",18)(37,ue,2,1,"div",19),n(),f(38,"br")(39,"br"),o(40,"div",20)(41,"label",21)(42,"input",22),_("change",function(g){return v(d),h(r.onLettreSelected(g))}),n(),s(43," \u{1F4CE} Joindre une lettre de motivation (facultatif) "),n(),m(44,me,2,1,"p",23)(45,pe,2,0,"button",24)(46,fe,4,1,"div",25)(47,ge,2,1,"div",19),n(),f(48,"br")(49,"br"),o(50,"button",26),s(51,"Postuler"),n()()}if(e&2){let d,u,g=M(34);a(2),l("formGroup",r.candidatureForm),a(),l("ngIf",r.authService.isAdmin()),a(),l("ngIf",r.authService.isAdmin()),a(),l("ngIf",r.authService.isAdmin()&&((d=r.candidatureForm.get("etudiantId"))==null?null:d.invalid)&&((d=r.candidatureForm.get("etudiantId"))==null?null:d.touched)),a(8),l("ngForOf",r.stages),a(),l("ngIf",((u=r.candidatureForm.get("stageId"))==null?null:u.invalid)&&((u=r.candidatureForm.get("stageId"))==null?null:u.touched)),a(18),l("ngIf",r.selectedFile)("ngIfElse",g),a(3),l("ngIf",r.selectedFile),a(),l("ngIf",r.pdfPreviewUrl),a(),l("ngIf",r.cvError),a(7),l("ngIf",r.lettreMotivationFile),a(),l("ngIf",r.lettreMotivationFile),a(),l("ngIf",r.lettreMotivationPreviewUrl),a(),l("ngIf",r.cvError),a(3),l("disabled",r.candidatureForm.invalid)}},dependencies:[O,w,P,$,z,j,B,V,q,A,R,G,N,L],styles:["form[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1rem;max-width:600px;margin:2rem auto;padding:2rem;border:1px solid #ddd;border-radius:8px;background-color:#fafafa}h2[_ngcontent-%COMP%]{text-align:center;margin-bottom:1.5rem;color:#1e3a8a}label[_ngcontent-%COMP%]{font-weight:700;margin-bottom:.3rem;color:#333}input[_ngcontent-%COMP%], select[_ngcontent-%COMP%], textarea[_ngcontent-%COMP%]{padding:.6rem;border:1px solid #ccc;border-radius:6px;font-size:1rem;width:100%;box-sizing:border-box}textarea[_ngcontent-%COMP%]{min-height:100px;resize:vertical}button[_ngcontent-%COMP%]{background-color:#2563eb;color:#fff;padding:.8rem;border:none;border-radius:6px;font-size:1rem;cursor:pointer;transition:background-color .3s ease}button[_ngcontent-%COMP%]:disabled{background-color:#94a3b8;cursor:not-allowed}button[_ngcontent-%COMP%]:hover:not(:disabled){background-color:#1d4ed8}.success[_ngcontent-%COMP%]{color:green;margin-bottom:10px}.error[_ngcontent-%COMP%]{color:red;margin-bottom:10px}.file-upload[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.5rem;margin-bottom:1.5rem}.upload-label[_ngcontent-%COMP%]{background-color:#007bff;color:#fff;padding:10px 15px;border-radius:5px;cursor:pointer;font-weight:700;width:fit-content;transition:background-color .3s ease}.upload-label[_ngcontent-%COMP%]:hover{background-color:#0056b3}.upload-display[_ngcontent-%COMP%]{font-style:italic;color:#555;font-size:.9rem}.no-file[_ngcontent-%COMP%]{color:#888}.cv-error[_ngcontent-%COMP%]{color:#dc3545;font-weight:500;font-size:.9rem}.pdf-preview[_ngcontent-%COMP%]{margin-top:1rem;border:1px solid #ccc;border-radius:6px;overflow:hidden;box-shadow:0 2px 8px #0000001a}.delete-file-btn[_ngcontent-%COMP%]{background-color:#dc3545;color:#fff;font-weight:700;border:none;border-radius:5px;padding:6px 12px;margin-top:.5rem;width:fit-content;cursor:pointer;transition:background-color .3s ease}.delete-file-btn[_ngcontent-%COMP%]:hover{background-color:#b02a37}.upload-section[_ngcontent-%COMP%]{margin-top:20px;display:flex;flex-direction:column;gap:10px}.custom-upload[_ngcontent-%COMP%]{display:inline-block;background-color:#6c757d;color:#fff;font-weight:700;padding:10px 20px;border-radius:5px;cursor:pointer;width:fit-content;transition:background-color .3s ease}.custom-upload[_ngcontent-%COMP%]:hover{background-color:#5a6268}.file-info[_ngcontent-%COMP%]{font-style:italic;color:#333;margin:0}.clear-btn[_ngcontent-%COMP%]{background-color:transparent;color:red;border:none;cursor:pointer;font-size:.9rem;width:fit-content;padding:2px}.clear-btn[_ngcontent-%COMP%]:hover{text-decoration:underline}.preview-box[_ngcontent-%COMP%]{border:1px solid #ccc;padding:10px;border-radius:4px;background-color:#f8f9fa}"]})};export{X as a};
