import{a as U}from"./chunk-A4HBSWL7.js";import{a as G}from"./chunk-4T322RVL.js";import{$ as P,A as b,B as c,D as l,R as w,T as I,Z as y,da as T,ea as q,fa as m,ga as M,ha as N,ja as A,ka as O,la as L,n as o,p as v,pa as k,q as F,qa as j,s as d,sa as R,t as s,ta as V,u as r,v as a,w as p}from"./chunk-XPQBKRV7.js";function B(e,n){e&1&&(r(0,"span"),l(1,"\u274C Le nom est requis."),a())}function z(e,n){if(e&1&&(r(0,"div",15),d(1,B,2,0,"span",9),a()),e&2){let i,t=c();o(),s("ngIf",(i=t.etudiantForm.get("nom"))==null||i.errors==null?null:i.errors.required)}}function H(e,n){e&1&&(r(0,"span"),l(1,"\u274C Le prenom est requis."),a())}function J(e,n){if(e&1&&(r(0,"div",15),d(1,H,2,0,"span",9),a()),e&2){let i,t=c();o(),s("ngIf",(i=t.etudiantForm.get("prenom"))==null||i.errors==null?null:i.errors.required)}}function K(e,n){e&1&&(r(0,"span"),l(1,"\u274C L'email est requis."),a())}function Q(e,n){e&1&&(r(0,"span"),l(1,"\u274C L'email n'est pas valide."),a())}function W(e,n){if(e&1&&(r(0,"div",15),d(1,K,2,0,"span",9)(2,Q,2,0,"span",9),a()),e&2){let i,t,u=c();o(),s("ngIf",(i=u.etudiantForm.get("email"))==null||i.errors==null?null:i.errors.required),o(),s("ngIf",(t=u.etudiantForm.get("email"))==null||t.errors==null?null:t.errors.email)}}function X(e,n){e&1&&(r(0,"span"),l(1,"\u274C Le numero de telephone est requis."),a())}function Y(e,n){if(e&1&&(r(0,"div",15),d(1,X,2,0,"span",9),a()),e&2){let i,t=c();o(),s("ngIf",(i=t.etudiantForm.get("telephone"))==null||i.errors==null?null:i.errors.required)}}function Z(e,n){e&1&&(r(0,"span"),l(1,"\u274C L'adresse est requis."),a())}function $(e,n){if(e&1&&(r(0,"div",15),d(1,Z,2,0,"span",9),a()),e&2){let i,t=c();o(),s("ngIf",(i=t.etudiantForm.get("adresse"))==null||i.errors==null?null:i.errors.required)}}function ee(e,n){e&1&&(r(0,"span"),l(1,"\u274C Le niveau d'etude est requis."),a())}function te(e,n){if(e&1&&(r(0,"div",15),d(1,ee,2,0,"span",9),a()),e&2){let i,t=c();o(),s("ngIf",(i=t.etudiantForm.get("niveauEtude"))==null||i.errors==null?null:i.errors.required)}}function ie(e,n){e&1&&(r(0,"span"),l(1,"\u274C La specialite est requise."),a())}function ne(e,n){if(e&1&&(r(0,"div",15),d(1,ie,2,0,"span",9),a()),e&2){let i,t=c();o(),s("ngIf",(i=t.etudiantForm.get("specialite"))==null||i.errors==null?null:i.errors.required)}}function re(e,n){e&1&&(r(0,"label"),l(1,"Ancien mot de passe :"),a())}function ae(e,n){e&1&&p(0,"input",16)}function oe(e,n){e&1&&(r(0,"span"),l(1,"\u274C L'ancien mot de passe est requis."),a())}function se(e,n){if(e&1&&(r(0,"div",15),d(1,oe,2,0,"span",9),a()),e&2){let i,t=c();o(),s("ngIf",!t.authService.isAdmin()&&((i=t.etudiantForm.get("oldPassword"))==null||i.errors==null?null:i.errors.required))}}function le(e,n){e&1&&(r(0,"span"),l(1,"\u274C Le nouveau mot de passe est requis."),a())}function de(e,n){if(e&1&&(r(0,"div",15),d(1,le,2,0,"span",9),a()),e&2){let i,t=c();o(),s("ngIf",(i=t.etudiantForm.get("newPassword"))==null||i.errors==null?null:i.errors.required)}}function ue(e,n){e&1&&(r(0,"div"),l(1," \u274C Les deux nouveaux mots de passe ne correspondent pas. "),a())}var D=class e{constructor(n,i,t,u,f,_,h){this.authService=n;this.fb=i;this.etudiantService=t;this.route=u;this.router=f;this.userService=_;this.alertService=h;this.etudiantForm=this.fb.group({nom:["",m.required],prenom:["",m.required],email:["",[m.required,m.email]],telephone:["",m.required],adresse:["",m.required],niveauEtude:["",m.required],specialite:["",m.required],password:["",m.required],oldPassword:["",m.required],newPassword:["",m.required],confirmPassword:["",m.required],user:[]},{validators:this.passwordsMatchValidator})}etudiantForm;etudiantId;userId;message="";messageType="";passwordsMatchValidator(n){let i=n.get("newPassword")?.value,t=n.get("confirmPassword")?.value;return i===t?null:{passwordMismatch:!0}}ngOnInit(){this.etudiantId=Number(this.route.snapshot.paramMap.get("id")),this.etudiantId&&this.etudiantService.getEtudiantById(this.etudiantId).subscribe(n=>{this.etudiantForm.patchValue({nom:n?.nom,prenom:n?.prenom,email:n?.user.email,telephone:n?.telephone,adresse:n?.adresse,niveauEtude:n?.niveauEtude,specialite:n?.specialite,password:n?.user.password,user:n?.user}),this.authService.isAdmin()&&this.etudiantForm.patchValue({oldPassword:n?.user.password}),this.userId=n?.user.id})}onSubmit(){if(console.log("Ohay a ce niveau!"),this.etudiantForm.valid&&this.etudiantId&&this.userId){if(this.etudiantForm.hasError("passwordMismatch")){this.messageType="error",this.message="\u274C Les nouveaux mots de passe ne correspondent pas.",this.alertService.error(this.message);return}let n={oldPassword:this.etudiantForm.value.oldPassword,newPassword:this.etudiantForm.value.newPassword};this.etudiantForm.value.password=this.etudiantForm.value.newPassword,this.etudiantForm.value.user.email=this.etudiantForm.value.email,this.etudiantForm.value.user.password=this.etudiantForm.value.password;let i={email:this.etudiantForm.value.email,password:this.etudiantForm.value.Password},t={id:this.etudiantId,nom:this.etudiantForm.value.nom,prenom:this.etudiantForm.value.prenom,telephone:this.etudiantForm.value.telephone,adresse:this.etudiantForm.value.adresse,niveauEtude:this.etudiantForm.value.niveauEtude,specialite:this.etudiantForm.value.specialite,user:this.etudiantForm.value.user};this.authService.isAdmin()?(this.userId&&this.userService.updateUser(this.userId,i).subscribe({next:()=>{},error:u=>{console.error("Erreur lors de la mise \xE0 jour du user",u)}}),this.etudiantId&&this.etudiantService.updateEtudiant(this.etudiantId,t).subscribe({next:()=>{this.messageType="success",this.message="\u2705 \xC9tudiant modifi\xE9 avec succ\xE8s !",this.alertService.success(this.message).then(()=>{this.router.navigate(["/etudiants",this.etudiantId])})},error:u=>{console.error("Erreur lors de la modification de l'etudiant",u),this.messageType="error",this.message="\u274C Erreur lors de la modification de l'etudiant.",this.alertService.error(this.message)}})):this.userService.verifyPassword(this.userId,this.etudiantForm.value.oldPassword).subscribe({next:()=>{this.userId&&this.userService.updateUser(this.userId,i).subscribe({next:()=>{},error:u=>{console.error("Erreur lors de la mise \xE0 jour du user",u)}}),this.etudiantId&&this.etudiantService.updateEtudiant(this.etudiantId,t).subscribe({next:()=>{this.messageType="success",this.message="\u2705 \xC9tudiant modifi\xE9 avec succ\xE8s !",this.alertService.success(this.message).then(()=>{this.router.navigate(["/etudiants",this.etudiantId])})},error:u=>{console.error("Erreur lors de la modification de l'etudiant",u),this.messageType="error",this.message="\u274C Erreur lors de la modification de l'etudiant.",this.alertService.error(this.message)}})},error:()=>{this.messageType="error",this.message="\u274C Ancien mot de passe incorrect.",this.alertService.error(this.message)}})}else this.messageType="error",this.message="\u26A0\uFE0F Merci de compl\xE9ter le formulaire correctement.",this.alertService.error(this.message)}annuler(){this.messageType="error",this.message="\u274C Ete vous sur de vouloir annuler les modifications ?",this.alertService.confirm(this.message).then(n=>{n.isConfirmed&&this.router.navigate(["/etudiants",this.etudiantId])})}static \u0275fac=function(i){return new(i||e)(v(T),v(j),v(U),v(y),v(P),v(G),v(V))};static \u0275cmp=F({type:e,selectors:[["app-etudiant-edit"]],decls:46,vars:14,consts:[[3,"ngSubmit","formGroup"],["type","text","formControlName","nom"],["class","error",4,"ngIf"],["type","text","formControlName","prenom"],["type","email","autocomplete","email","formControlName","email"],["type","text","formControlName","telephone"],["type","text","formControlName","adresse"],["type","text","formControlName","niveauEtude"],["type","text","formControlName","specialite"],[4,"ngIf"],["type","password","autocomplete","current-password","formControlName","oldPassword","required","",4,"ngIf"],["type","password","autocomplete","current-password","formControlName","newPassword","required",""],["type","password","autocomplete","current-password","formControlName","confirmPassword","required",""],["type","submit",3,"disabled"],["type","button",3,"click"],[1,"error"],["type","password","autocomplete","current-password","formControlName","oldPassword","required",""]],template:function(i,t){if(i&1&&(r(0,"h2"),l(1,"Modifier un \xC9tudiant"),a(),r(2,"form",0),b("ngSubmit",function(){return t.onSubmit()}),r(3,"label"),l(4,"Nom :"),a(),p(5,"input",1),d(6,z,2,1,"div",2),r(7,"label"),l(8,"Prenom :"),a(),p(9,"input",3),d(10,J,2,1,"div",2),r(11,"label"),l(12,"Email :"),a(),p(13,"input",4),d(14,W,3,2,"div",2),r(15,"label"),l(16,"T\xE9l\xE9phone :"),a(),p(17,"input",5),d(18,Y,2,1,"div",2),r(19,"label"),l(20,"Adresse :"),a(),p(21,"input",6),d(22,$,2,1,"div",2),r(23,"label"),l(24,"Niveau d'\xE9tude :"),a(),p(25,"input",7),d(26,te,2,1,"div",2),r(27,"label"),l(28,"Sp\xE9cialit\xE9 :"),a(),p(29,"input",8),d(30,ne,2,1,"div",2)(31,re,2,0,"label",9)(32,ae,1,0,"input",10)(33,se,2,1,"div",2),r(34,"label"),l(35,"Nouveau mot de passe :"),a(),p(36,"input",11),d(37,de,2,1,"div",2),r(38,"label"),l(39,"Confirmation du nouveau mot de passe :"),a(),p(40,"input",12),d(41,ue,2,0,"div",9),r(42,"button",13),l(43,"Enregistrer"),a(),r(44,"button",14),b("click",function(){return t.annuler()}),l(45,"Annuler"),a()()),i&2){let u,f,_,h,g,E,x,C,S;o(2),s("formGroup",t.etudiantForm),o(4),s("ngIf",((u=t.etudiantForm.get("nom"))==null?null:u.invalid)&&((u=t.etudiantForm.get("nom"))==null?null:u.touched)),o(4),s("ngIf",((f=t.etudiantForm.get("prenom"))==null?null:f.invalid)&&((f=t.etudiantForm.get("prenom"))==null?null:f.touched)),o(4),s("ngIf",((_=t.etudiantForm.get("email"))==null?null:_.invalid)&&((_=t.etudiantForm.get("email"))==null?null:_.touched)),o(4),s("ngIf",((h=t.etudiantForm.get("telephone"))==null?null:h.invalid)&&((h=t.etudiantForm.get("telephone"))==null?null:h.touched)),o(4),s("ngIf",((g=t.etudiantForm.get("adresse"))==null?null:g.invalid)&&((g=t.etudiantForm.get("adresse"))==null?null:g.touched)),o(4),s("ngIf",((E=t.etudiantForm.get("niveauEtude"))==null?null:E.invalid)&&((E=t.etudiantForm.get("niveauEtude"))==null?null:E.touched)),o(4),s("ngIf",((x=t.etudiantForm.get("specialite"))==null?null:x.invalid)&&((x=t.etudiantForm.get("specialite"))==null?null:x.touched)),o(),s("ngIf",!t.authService.isAdmin()),o(),s("ngIf",!t.authService.isAdmin()),o(),s("ngIf",!t.authService.isAdmin()&&((C=t.etudiantForm.get("oldPassword"))==null?null:C.invalid)&&((C=t.etudiantForm.get("oldPassword"))==null?null:C.touched)),o(4),s("ngIf",((S=t.etudiantForm.get("newPassword"))==null?null:S.invalid)&&((S=t.etudiantForm.get("newPassword"))==null?null:S.touched)),o(4),s("ngIf",t.etudiantForm.hasError("passwordMismatch")),o(),s("disabled",t.etudiantForm.invalid)}},dependencies:[I,w,R,A,q,M,N,k,O,L],styles:["form[_ngcontent-%COMP%]{max-width:600px;margin:50px auto;padding:30px;background:#fff;border-radius:8px;box-shadow:0 0 10px #0000001a}input[_ngcontent-%COMP%], select[_ngcontent-%COMP%], textarea[_ngcontent-%COMP%]{width:100%;padding:10px 15px;margin:10px 0 20px;border:1px solid #ccc;border-radius:5px;font-size:1rem}label[_ngcontent-%COMP%]{font-weight:700;display:block;margin-bottom:5px}button[_ngcontent-%COMP%]{padding:10px 20px;margin-right:10px;background-color:#007bff;color:#fff;border:none;border-radius:6px;cursor:pointer;font-size:1rem;transition:background-color .3s}button[_ngcontent-%COMP%]:hover{background-color:#0056b3}button[type=button][_ngcontent-%COMP%]{background-color:#6c757d}button[type=button][_ngcontent-%COMP%]:hover{background-color:#565e64}h2[_ngcontent-%COMP%]{text-align:center;margin-bottom:30px;color:#333}.error[_ngcontent-%COMP%]{color:red;margin-bottom:10px}"]})};export{D as EtudiantEditComponent};
